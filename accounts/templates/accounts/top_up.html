{% load static %}
{% load humanize %}
{% load widget_tweaks %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Top Up - Starlink Bank</title>
  <link href="{% static 'img/favicon2.ico' %}" rel="icon">
  <link href="{% static 'img/apple-touch-icon.png' %}" rel="apple-touch-icon">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet">
  <link href="{% static 'css/main.css' %}" rel="stylesheet">
  <style>
    .card-custom {
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
    }
    .balance-card {
      background: linear-gradient(135deg, #4e54c8, #8f94fb);
      color: #fff;
      text-align: center;
      font-weight: 500;
      font-size: 1.2rem;
    }
    .btn-success:hover {
      background-color: #3c8dbc;
      border-color: #3c8dbc;
    }
    @media (max-width: 576px) {
      .balance-card {
        font-size: 1rem;
      }
    }
  </style>
</head>

<body class="dashboard-page">

  <!-- Header -->
  <header id="header" class="header d-flex align-items-center sticky-top">
    <div class="container-fluid d-flex justify-content-between align-items-center flex-wrap">
      <a href="{% url 'index' %}" class="logo d-flex align-items-center mb-2 mb-md-0">
        <h1 class="sitename">SkyBank</h1><span>.</span>
      </a>
      <nav id="navmenu" class="navmenu mb-2 mb-md-0">
        <ul class="d-flex flex-wrap gap-2 gap-md-3 list-unstyled mb-0">
          <li><a href="{% url 'index' %}" class="active">Home</a></li>
          <li><a href="{% url 'index' %}#about">About</a></li>
          <li><a href="{% url 'index' %}#services">Services</a></li>
          <li><a href="{% url 'index' %}#faq">FAQs</a></li>
          <li><a href="{% url 'index' %}#contact">Contact</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>
      <a class="btn btn-outline-light" href="{% url 'logout' %}">Logout</a>
    </div>
  </header>

  <!-- Main Content -->
  <div class="container mt-5">
    <h2 class="mb-4 text-center">Top Up Balance</h2>

    <!-- Balance Card -->
    <div class="card card-custom balance-card mb-4 p-3">
      <div>Current Balance</div>
      <div class="fs-3">${{ account.balance|floatformat:2|intcomma }}</div>
    </div>

    <!-- Payment Methods Card -->
    {% if payment %}
    <div class="card card-custom mb-4 p-3">
      <h5 class="mb-3">Payment Options</h5>
      <div class="d-flex flex-column flex-sm-row flex-wrap justify-content-between mb-2 align-items-sm-center">
        <p class="mb-1 mb-sm-0 fw-bold">PayPal:</p>
        <span class="mb-1 mb-sm-0 text-muted" id="paypalText">{{ payment.paypal_email }}</span>
        <button class="btn btn-outline-primary btn-sm mt-1 mt-sm-0 btn-copy" data-copy="#paypalText">Copy</button>
      </div>
      <div class="d-flex flex-column flex-sm-row flex-wrap justify-content-between mb-2 align-items-sm-center">
        <p class="mb-1 mb-sm-0 fw-bold">CashApp:</p>
        <span class="mb-1 mb-sm-0 text-muted" id="cashappText">{{ payment.cashapp_tag }}</span>
        <button class="btn btn-outline-success btn-sm mt-1 mt-sm-0 btn-copy" data-copy="#cashappText">Copy</button>
      </div>
      <div class="d-flex flex-column flex-sm-row flex-wrap justify-content-between align-items-sm-center">
        <p class="mb-1 mb-sm-0 fw-bold">Bitcoin (BTC):</p>
        <span class="mb-1 mb-sm-0 text-muted" id="btcText">{{ payment.bitcoin_address }}</span>
        <button class="btn btn-outline-warning btn-sm mt-1 mt-sm-0 btn-copy" data-copy="#btcText">Copy</button>
      </div>
    </div>
    {% endif %}

    <!-- Top-Up Form Card -->
    <div class="card card-custom p-4 mb-4">
      <form method="POST">
        {% csrf_token %}
        <div class="mb-3">
          <label for="amount" class="form-label">Amount</label>
          <input type="number" step="0.01" class="form-control" id="amount" name="amount"
                 placeholder="Enter amount to top up" required>
        </div>
        <button type="submit" class="btn btn-success w-100">Top Up</button>
      </form>
    </div>

    <!-- Messages -->
    {% if messages %}
      <div class="mt-3">
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  <!-- Footer -->
  <footer id="footer" class="footer dark-background mt-5">
    <div class="container text-center py-3">
      © Copyright <strong>Starlink Bank</strong>. All Rights Reserved
    </div>
  </footer>

  <script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
  <script>
    // Copy to clipboard
    document.querySelectorAll(".btn-copy").forEach(btn=>{
      btn.addEventListener("click", ()=> {
        const selector = btn.getAttribute("data-copy");
        const node = document.querySelector(selector);
        if (!node) return;
        const text = node.innerText.trim();
        if (!text) { alert("Nothing to copy"); return; }
        navigator.clipboard?.writeText(text).then(()=>{
          const old = btn.innerHTML;
          btn.innerHTML = 'Copied';
          setTimeout(()=> btn.innerHTML = old, 1400);
        }).catch(()=> alert("Copy failed — please copy manually."));
      });
    });

    // Mobile nav toggle
    const toggle = document.querySelector('.mobile-nav-toggle');
    const menu = document.querySelector('#navmenu ul');
    toggle.addEventListener('click', () => {
      menu.classList.toggle('d-none');
    });
  </script>
</body>
</html>